# –¢–µ—Ä—Ä–µ–π–Ω: GfxTerrainConfig –∏ GfxHeightSampler

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç–µ—Ä—Ä–µ–π–Ω–∞ –≤ Qryleth: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤—ã—Å–æ—Ç, –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ–ª—å–µ—Ñ–∞ –∏ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—ç–º–ø–ª–∏–Ω–≥–∞ –≤—ã—Å–æ—Ç—ã/–Ω–æ—Ä–º–∞–ª–µ–π.

---

## –û–±–∑–æ—Ä

- **–¶–µ–ª—å:** —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—ã—Å–æ—Ç –º–µ–∂–¥—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º –∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–æ–≤.
- **–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:** –ª—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –≤—ã—Å–æ—Ç–æ–π (—Ä–µ–Ω–¥–µ—Ä, —Ñ–∏–∑–∏–∫–∞, —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ) –∏–¥—É—Ç —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π `GfxHeightSampler`.
- **–ò—Å—Ç–æ—á–Ω–∏–∫–∏:** Perlin (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à—É–º), PNG heightmap (Dexie).
- **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:** `TerrainOps` ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–æ–±–∞–≤–∫–∏ —Ä–µ–ª—å–µ—Ñ–∞ (add/sub/set, falloff, —ç–ª–ª–∏–ø—Å—ã, –ø–æ–≤–æ—Ä–æ—Ç).

---

## –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

```ts
// –î–∞–Ω–Ω—ã–µ perlin-—à—É–º–∞ (—Ä–∞–∑–º–µ—Ä—ã ‚Äî –≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö —Å–µ—Ç–∫–∏)
export interface GfxPerlinParams {
  /**
   * –ó–µ—Ä–Ω–æ —à—É–º–∞ Perlin –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
   */
  seed: number
  /**
   * –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∫—Ç–∞–≤ —à—É–º–∞ (—á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –¥–µ—Ç–∞–ª—å–Ω–µ–µ —Ä–µ–ª—å–µ—Ñ).
   */
  octaveCount: number
  /**
   * –ê–º–ø–ª–∏—Ç—É–¥–∞ –±–∞–∑–æ–≤–æ–≥–æ —Ä–µ–ª—å–µ—Ñ–∞. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—É—é –≤—ã—Å–æ—Ç—É –≥–æ—Ä/–≤–ø–∞–¥–∏–Ω.
   */
  amplitude: number
  /**
   * –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è –º–µ–∂–¥—É –æ–∫—Ç–∞–≤–∞–º–∏ (0..1). –ú–µ–Ω—å—à–µ ‚Äî –≥–ª–∞–∂–µ, –±–æ–ª—å—à–µ ‚Äî —à—É–º–Ω–µ–µ.
   */
  persistence: number
  /**
   * –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ —à—É–º–∞ –ø–æ X (–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö —Å–µ—Ç–∫–∏ —Ç–µ—Ä—Ä–µ–π–Ω–∞, –Ω–µ –≤ –º–µ—Ç—Ä–∞—Ö).
   */
  width: number
  /**
   * –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ —à—É–º–∞ –ø–æ Z (–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö —Å–µ—Ç–∫–∏ —Ç–µ—Ä—Ä–µ–π–Ω–∞, –Ω–µ –≤ –º–µ—Ç—Ä–∞—Ö).
   */
  height: number
  /**
   * –°–º–µ—â–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤—ã—Å–æ—Ç—ã (DC‚Äë—Å–º–µ—â–µ–Ω–∏–µ) –≤ –º–µ—Ç—Ä–∞—Ö. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—É—Å–∫–∞—Ç—å
   * (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è) –∏–ª–∏ –ø–æ–¥–Ω–∏–º–∞—Ç—å (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ) –≤–µ—Å—å –±–∞–∑–æ–≤—ã–π —Ä–µ–ª—å–µ—Ñ
   * –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω—É–ª–µ–≤–æ–π –ø–ª–æ—Å–∫–æ—Å—Ç–∏ Y=0 –∏–ª–∏ —É—Ä–æ–≤–Ω—è –º–æ—Ä—è.
   *
   * –§–æ—Ä–º—É–ª–∞:
   *   h_base(x,z) = amplitude * perlin(x,z) + heightOffset
   *
   * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0 (–æ—Ç–∫–ª—é—á–µ–Ω–æ).
   */
  heightOffset?: number
}

// –î–∞–Ω–Ω—ã–µ PNG heightmap (—Ä–∞–∑–º–µ—Ä—ã ‚Äî –ø–∏–∫—Å–µ–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
export interface GfxHeightmapParams {
  assetId: string        // –∫–ª—é—á blob PNG –≤ Dexie
  imgWidth: number
  imgHeight: number
  min: number            // –Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã—Å–æ—Ç—ã
  max: number            // –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã—Å–æ—Ç—ã
  wrap?: 'clamp' | 'repeat' // —Ä–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ UV –Ω–∞ –∫—Ä–∞—è—Ö
}

// –ò—Å—Ç–æ—á–Ω–∏–∫ –±–∞–∑–æ–≤—ã—Ö –≤—ã—Å–æ—Ç —Ç–µ—Ä—Ä–µ–π–Ω–∞
export type GfxTerrainSource =
  | { kind: 'perlin'; params: GfxPerlinParams }
  | { kind: 'heightmap'; params: GfxHeightmapParams }

// –û–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ–ª—å–µ—Ñ–∞
export interface GfxTerrainOp {
  id: string
  mode: 'add' | 'sub' | 'set'
  center: [number, number] // –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (x, z)
  radius: number            // —Ä–∞–¥–∏—É—Å –≤–ª–∏—è–Ω–∏—è (–º–∏—Ä–æ–≤—ã–µ –µ–¥–∏–Ω–∏—Ü—ã)
  intensity: number         // –∞–º–ø–ª–∏—Ç—É–¥–∞
  falloff?: 'smoothstep' | 'gauss' | 'linear'
  radiusZ?: number          // —ç–ª–ª–∏–ø—Å –ø–æ Z (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
  rotation?: number         // –ø–æ–≤–æ—Ä–æ—Ç —ç–ª–ª–∏–ø—Å–∞ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö
}

// –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Ä—Ä–µ–π–Ω–∞ —Å–ª–æ—è
export interface GfxTerrainConfig {
  /** –®–∏—Ä–∏–Ω–∞ —Ç–µ—Ä—Ä–µ–π–Ω–∞ –≤ –º–∏—Ä–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö (–º–µ—Ç—Ä–∞—Ö). */
  worldWidth: number
  /** –ì–ª—É–±–∏–Ω–∞ —Ç–µ—Ä—Ä–µ–π–Ω–∞ (–æ—Å—å Z) –≤ –º–∏—Ä–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö (–º–µ—Ç—Ä–∞—Ö). */
  worldHeight: number
  /**
   * –ü–ª–∞–≤–Ω—ã–π —Å–ø–∞–¥ –≤—ã—Å–æ—Ç—ã –∫ –∫—Ä–∞—è–º (0..1 ‚Äî –¥–æ–ª—è –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∫—Ä–∞—è).
   * –í–ê–ñ–ù–û: —Å–ø–∞–¥ –≤–µ–¥—ë—Ç –∫ –±–∞–∑–æ–≤–æ–º—É —É—Ä–æ–≤–Ω—é –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –î–ª—è Perlin —ç—Ç–æ `heightOffset`
   * (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω) –∏–ª–∏ 0.
   */
  edgeFade?: number
  /**
   * –£—Ä–æ–≤–µ–Ω—å –º–æ—Ä—è (–≤—ã—Å–æ—Ç–∞ –ø–ª–æ—Å–∫–æ—Å—Ç–∏ –≤–æ–¥—ã) –≤ –º–µ—Ç—Ä–∞—Ö. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω, —Å—á–∏—Ç–∞–µ—Ç—Å—è 0.
   * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–¥—ã –∏ —Å—ç–º–ø–ª–∏–Ω–≥–∞ –≤—ã—Å–æ—Ç –Ω–∏–∂–µ 0.
   */
  seaLevel?: number
  /** –ò—Å—Ç–æ—á–Ω–∏–∫ –±–∞–∑–æ–≤—ã—Ö –≤—ã—Å–æ—Ç (Perlin –∏–ª–∏ –∫–∞—Ä—Ç–∞ –≤—ã—Å–æ—Ç). */
  source: GfxTerrainSource
  /** –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π —Ä–µ–ª—å–µ—Ñ–∞. */
  ops?: GfxTerrainOp[]
}
```

---

## –°—ç–º–ø–ª–µ—Ä –≤—ã—Å–æ—Ç—ã

```ts
export interface GfxHeightSampler {
  /**
   * –ü–æ–ª—É—á–∏—Ç—å –≤—ã—Å–æ—Ç—É Y –¥–ª—è –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (x, z)
   * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—ã—Å–æ—Ç—É –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞, ops –∏ edgeFade.
   *
   * –î–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏:
   * - –î–ª—è Perlin-–∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤—ã—Å–æ—Ç–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:
   *     h(x,z) = amplitude * sumOctaves(perlin) + heightOffset (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
   * - Edge fade –∏–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ—Ç –∫ –±–∞–∑–æ–≤–æ–º—É —É—Ä–æ–≤–Ω—é –∏—Å—Ç–æ—á–Ω–∏–∫–∞: –ø—Ä–∏ Perlin ‚Äî –∫
   *   `heightOffset` (–∏–ª–∏ 0, –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω), –∞ –ù–ï –∫ –∂—ë—Å—Ç–∫–æ–º—É –Ω—É–ª—é.
   * - –ö–ª–∞–º–ø –∫ 0 –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è: –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –≤—ã—Å–æ—Ç—ã –¥–æ–ø—É—Å—Ç–∏–º—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
   *   –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–Ω–∞/–ø–æ–¥–≤–æ–¥–Ω–æ–≥–æ —Ä–µ–ª—å–µ—Ñ–∞.
   */
  getHeight(x: number, z: number): number

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –Ω–æ—Ä–º–∞–ª—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –≤ —Ç–æ—á–∫–µ (x, z)
   * –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω–µ—á–Ω—ã–µ —Ä–∞–∑–Ω–æ—Å—Ç–∏; —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä.
   */
  getNormal(x: number, z: number): [number, number, number]

  /**
   * –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–±—ç–∫, –≤—ã–∑—ã–≤–∞–µ–º—ã–π –ø–æ—Å–ª–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ ImageData
   * –¥–ª—è heightmap-–∏—Å—Ç–æ—á–Ω–∏–∫–∞. –ù—É–∂–µ–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –≤ UI.
   */
  onHeightmapLoaded?(cb: () => void): void
}
```

- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: `src/features/scene/lib/terrain/GfxHeightSampler.ts`
- –°–æ–∑–¥–∞–Ω–∏–µ: `createGfxHeightSampler(cfg: GfxTerrainConfig)`
- –ì–µ–æ–º–µ—Ç—Ä–∏—è: `buildGfxTerrainGeometry(cfg, sampler)` –∏–∑ `src/features/scene/lib/terrain/GeometryBuilder.ts` ‚Äî —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `THREE.BufferGeometry` –ø–æ —Å—ç–º–ø–ª–µ—Ä—É.
 - –ì–µ–æ–º–µ—Ç—Ä–∏—è: `buildGfxTerrainGeometry(cfg, sampler)` –∏–∑ `src/features/scene/lib/terrain/GeometryBuilder.ts` ‚Äî —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `THREE.BufferGeometry` –ø–æ —Å—ç–º–ø–ª–µ—Ä—É.
   –ì–µ–æ–º–µ—Ç—Ä–∏—è –Ω–µ –∫–ª–∞–º–ø–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã –∫ 0 ‚Äî –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –≤—ã—Å–æ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å—ç–º–ø–ª–µ—Ä–∞

- `isReady()` ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –≥–æ—Ç–æ–≤ –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –≤—ã–±–æ—Ä–∫–∞–º (Perlin ‚Äî –≤—Å–µ–≥–¥–∞ true; Heightmap ‚Äî –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ heights/ImageData).
- `ready()` ‚Äî –ø—Ä–æ–º–∏—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ UI –≤–º–µ—Å—Ç–æ —Ç–∞–π–º–µ—Ä–æ–≤ –¥–ª—è –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–æ–≤.
- `dispose()` ‚Äî –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫/—Å—Å—ã–ª–æ–∫.

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ —É—Ä–æ–≤–Ω—é –º–æ—Ä—è –∏ –±–∞–∑–æ–≤–æ–º—É —Å–º–µ—â–µ–Ω–∏—é

- –ï—Å–ª–∏ –∑–∞–¥–∞–Ω `cfg.seaLevel`, –≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–ª–æ—Å–∫–æ—Å—Ç—å –≤–æ–¥—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
  –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ–≥–æ 0.
- –î–ª—è Perlin-–∏—Å—Ç–æ—á–Ω–∏–∫–∞ `params.heightOffset` –∑–∞–¥–∞—ë—Ç –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å —Ä–µ–ª—å–µ—Ñ–∞. –≠—Ç–æ
  –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å –∞—Ä—Ö–∏–ø–µ–ª–∞–≥–∞–º–∏: –º–æ–∂–Ω–æ –æ–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—É –Ω–∏–∂–µ `seaLevel`,
  –æ—Å—Ç–∞–≤–∏–≤ –Ω–∞–¥ –≤–æ–¥–æ–π —Ç–æ–ª—å–∫–æ –æ—Å—Ç—Ä–æ–≤–∞, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏/–¥–µ—Ç–∞–ª—è–º–∏.

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ

```ts
import { createGfxHeightSampler } from '@/features/scene/lib/terrain/GfxHeightSampler'
import { buildGfxTerrainGeometry } from '@/features/scene/lib/terrain/GeometryBuilder'

// 1) –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–µ—Ä—Ä–µ–π–Ω–∞
const sampler = createGfxHeightSampler(layer.terrain)
await sampler.ready?.() // –¥–ª—è heightmap –¥–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
const geometry = buildGfxTerrainGeometry(layer.terrain, sampler)
```

- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `src/features/scene/ui/renderer/landscape/LandscapeLayer.tsx`
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
  - –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `layer.terrain` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é;
  - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—è –¥–æ–ª–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–µ—Ä—Ä–µ–π–Ω–∞ —á–µ—Ä–µ–∑ SceneAPI (—Ä–µ–Ω–¥–µ—Ä –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç store).

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤

```ts
// –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤—ã—Å–æ—Ç–∞–º
const sampler = getHeightSamplerForLayer(layer)
const y = sampler.getHeight(x, z)
const n = sampler.getNormal(x, z)
```

- –ú–æ–¥—É–ª—å: `src/features/scene/lib/placement/ObjectPlacementUtils.ts`
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã—Å–æ—Ç –∏ –Ω–æ—Ä–º–∞–ª–µ–π –º–µ–∂–¥—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º –∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º.

---

## –ò–º–ø–æ—Ä—Ç PNG heightmap

- Dexie-—Ç–∞–±–ª–∏—Ü–∞: `terrainAssets` (PNG blob, `heightsBuffer`, `heightsHash`).
- –£—Ç–∏–ª–∏—Ç—ã: `src/features/scene/lib/terrain/HeightmapUtils.ts`
  - `validatePngFile()`, `uploadTerrainAsset()`, `createTerrainAssetPreviewUrl()` –∏ –¥—Ä.
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –≤—Ö–æ–¥–Ω–æ–π PNG –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–æ ‚â§200px –ø–æ –±–æ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ, –∑–∞—Ç–µ–º –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ –≤—ã—Å–æ—Ç (`Float32Array`).
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è: –ø–æ SHA‚Äë256 —Ö—ç—à—É –º–∞—Å—Å–∏–≤–∞ –≤—ã—Å–æ—Ç (`heightsHash`). –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–π –∫–∞—Ä—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞—Å—Å–µ—Ç (–Ω–æ–≤—ã–π –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è).
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ heights/ImageData; –æ–∂–∏–¥–∞–Ω–∏–µ —Å–ª–µ–¥—É–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —á–µ—Ä–µ–∑ `sampler.ready()`.

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è

- –ö—ç—à `assets/heightmapCache.ts` —Ö—Ä–∞–Ω–∏—Ç ImageData –∏ —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –≤—ã—Å–æ—Ç —Å TTL/LRU, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç `invalidate(assetId)` –∏ `clear()`.
- `HeightmapUtils.deleteTerrainAsset/renameTerrainAsset` –≤—ã–∑—ã–≤–∞—é—Ç `invalidate(assetId)` –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

---

## –ü—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ—ë–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏

### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ—è —Å Perlin Noise

```ts
import type { GfxTerrainConfig } from '@/entities/terrain'

const perlinTerrainConfig: GfxTerrainConfig = {
  worldWidth: 200,
  worldHeight: 200,
  edgeFade: 0.1,
  seaLevel: 0, // —É—Ä–æ–≤–µ–Ω—å –º–æ—Ä—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)
  source: {
    kind: 'perlin',
    params: {
      seed: 12345,           // –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–µ—Ä–Ω–æ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏
      octaveCount: 4,        // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤ —à—É–º–∞ (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è)
      amplitude: 8.0,        // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Ä–µ–ª—å–µ—Ñ–∞
      persistence: 0.5,      // –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –∞–º–ø–ª–∏—Ç—É–¥—ã –º–µ–∂–¥—É –æ–∫—Ç–∞–≤–∞–º–∏
      width: 64,             // —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ –ø–æ —à–∏—Ä–∏–Ω–µ (–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö)
      height: 64,            // —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ –ø–æ –≤—ã—Å–æ—Ç–µ (–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö)
      heightOffset: 0        // —Å–º–µ—â–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è; –º–æ–∂–µ—Ç –±—ã—Ç—å < 0
    }
  },
  ops: [
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö–æ–ª–º–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ
    {
      id: 'central-hill',
      mode: 'add',
      center: [100, 100],
      radius: 30,
      intensity: 5.0,
      falloff: 'smoothstep'
    },
    // –í—ã–µ–º–∫–∞-–æ–∑–µ—Ä–æ
    {
      id: 'lake',
      mode: 'sub',
      center: [150, 150],
      radius: 20,
      radiusZ: 15,          // —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º–∞
      rotation: Math.PI / 4, // –ø–æ–≤–æ—Ä–æ—Ç –Ω–∞ 45¬∞
      intensity: 3.0,
      falloff: 'gauss'
    }
  ]
}
```

#### –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Perlin Noise:

- **seed**: –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–µ—Ä–Ω–æ ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –¥–∞—ë—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–µ–ª—å–µ—Ñ
- **octaveCount**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤ —à—É–º–∞. –ë–æ–ª—å—à–µ –æ–∫—Ç–∞–≤ = –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∏ —Å–ª–æ–∂–Ω—ã–π —Ä–µ–ª—å–µ—Ñ
- **amplitude**: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ —Ä–µ–ª—å–µ—Ñ–∞ (–≤ –º–∏—Ä–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö)
- **persistence**: –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è –∞–º–ø–ª–∏—Ç—É–¥—ã –º–µ–∂–¥—É –æ–∫—Ç–∞–≤–∞–º–∏ (0.0-1.0). –ú–µ–Ω—å—à–µ = –±–æ–ª–µ–µ –≥–ª–∞–¥–∫–∏–π —Ä–µ–ª—å–µ—Ñ
- **width/height**: —Ä–∞–∑–º–µ—Ä—ã —Å–µ—Ç–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —à—É–º–∞ (–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö). –í–ª–∏—è—é—Ç –Ω–∞ —á–∞—Å—Ç–æ—Ç—É –¥–µ—Ç–∞–ª–µ–π

#### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Perlin:

**–ì–æ—Ä–Ω—ã–π –ª–∞–Ω–¥—à–∞—Ñ—Ç (–≤—ã—Å–æ–∫–∞—è –∞–º–ø–ª–∏—Ç—É–¥–∞, –º–Ω–æ–≥–æ –¥–µ—Ç–∞–ª–µ–π):**
```ts
const mountainTerrain: GfxTerrainConfig = {
  worldWidth: 300,
  worldHeight: 300,
  source: {
    kind: 'perlin',
    params: {
      seed: 9876,
      octaveCount: 6,      // –º–Ω–æ–≥–æ —Å–ª–æ—ë–≤ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
      amplitude: 15.0,     // –≤—ã—Å–æ–∫–∏–µ –≥–æ—Ä—ã
      persistence: 0.6,    // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π
      width: 128,
      height: 128
    }
  }
}
```

**–•–æ–ª–º–∏—Å—Ç–∞—è —Ä–∞–≤–Ω–∏–Ω–∞ (–º—è–≥–∫–∏–π —Ä–µ–ª—å–µ—Ñ):**
```ts
const hillsTerrain: GfxTerrainConfig = {
  worldWidth: 200,
  worldHeight: 200,
  source: {
    kind: 'perlin',
    params: {
      seed: 1111,
      octaveCount: 3,      // –º–∞–ª–æ —Å–ª–æ—ë–≤ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
      amplitude: 4.0,      // –Ω–µ–≤—ã—Å–æ–∫–∏–µ —Ö–æ–ª–º—ã
      persistence: 0.3,    // –±—ã—Å—Ç—Ä–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π
      width: 32,           // –∫—Ä—É–ø–Ω–∞—è —Å–µ—Ç–∫–∞ = –ø–ª–∞–≤–Ω—ã–µ —Ñ–æ—Ä–º—ã
      height: 32
    }
  }
}
```

**–ü—É—Å—Ç—ã–Ω–Ω—ã–µ –¥—é–Ω—ã (—Å—Ä–µ–¥–Ω–∏–π —Ä–µ–ª—å–µ—Ñ):**
```ts
const dunesTerrain: GfxTerrainConfig = {
  worldWidth: 150,
  worldHeight: 150,
  source: {
    kind: 'perlin',
    params: {
      seed: 5555,
      octaveCount: 4,
      amplitude: 8.0,
      persistence: 0.4,    // —É–º–µ—Ä–µ–Ω–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
      width: 48,
      height: 48
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ—è —Å heightmap

```ts
import type { GfxTerrainConfig } from '@/entities/terrain'

const heightmapTerrainConfig: GfxTerrainConfig = {
  worldWidth: 100,
  worldHeight: 100,
  edgeFade: 0.15,
  source: {
    kind: 'heightmap',
    params: {
      assetId: 'dexie-asset-id',  // ID –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ PNG –≤ Dexie
      imgWidth: 1024,             // —à–∏—Ä–∏–Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      imgHeight: 1024,            // –≤—ã—Å–æ—Ç–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      min: 0,                     // –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ (—á—ë—Ä–Ω—ã–µ –ø–∏–∫—Å–µ–ª–∏)
      max: 10,                    // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ (–±–µ–ª—ã–µ –ø–∏–∫—Å–µ–ª–∏)
      wrap: 'clamp'               // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∞—ë–≤: 'clamp' | 'repeat'
    }
  }
}
```

---

## –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `GfxLayer.noiseData` –∏ —Ä–µ–∂–∏–º–∞ `legacy` —É–¥–∞–ª–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `terrain: GfxTerrainConfig`.
- Scene API `adjustInstancesForPerlinTerrain` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–º—è, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –°—ç–º–ø–ª–µ—Ä –≤–∫–ª—é—á–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –≤—ã—Å–æ—Ç –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è `TerrainOps`.
- R3F-–≥–µ–æ–º–µ—Ç—Ä–∏—è —Å—Ç—Ä–æ–∏—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞/–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤/–∑–∞–≥—Ä—É–∑–∫–µ heightmap.
- `assets/heightmapCache.ts` –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–æ—Å—Ç –ø–∞–º—è—Ç–∏ –∑–∞ —Å—á—ë—Ç TTL/LRU.

---

## üÜï –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (spec/pool/recipes)

–¢–∏–ø—ã —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—É–ª–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ—Ç–æ–¥–∞–º–∏ SceneAPI `generateProceduralTerrain(...)`, `generateTerrainOpsFromPool(...)` –∏ `createProceduralLayer(...)`.

```ts
export interface GfxProceduralPerlinParams extends GfxPerlinParams {
  /** –°–¥–≤–∏–≥ —à—É–º–∞ –ø–æ XZ –¥–ª—è –≤–∞—Ä–∏–∞—Ü–∏–π –±–µ–∑ —Å–º–µ–Ω—ã seed: [dx, dz] */
  offset?: [number, number]
}

export interface GfxProceduralTerrainSpec {
  world: { width: number; height: number; edgeFade?: number }
  base: GfxProceduralPerlinParams
  pool: GfxTerrainOpPool
  seed: number
}

export interface GfxTerrainOpPool {
  global?: { intensityScale?: number; maxOps?: number }
  recipes: GfxTerrainOpRecipe[]
}

export interface GfxTerrainOpRecipe {
  kind: 'hill' | 'basin' | 'ridge' | 'valley' | 'crater' | 'plateau' | 'terrace' | 'dune'
  mode?: 'auto' | 'add' | 'sub' | 'set'
  count: number | [number, number]
  placement: GfxPlacementSpec
  radius: number | [number, number]
  aspect?: [number, number]
  intensity: number | [number, number]
  rotation?: [number, number]
  falloff?: 'smoothstep' | 'gauss' | 'linear'
  bias?: GfxBiasSpec
  jitter?: { center?: number }
  step?: number
}

export type GfxPlacementSpec =
  | { type: 'uniform' }
  | { type: 'poisson', minDistance: number }
  | { type: 'gridJitter', cell: number, jitter?: number }
  | { type: 'ring', center: [number, number], rMin: number, rMax: number }

export interface GfxBiasSpec {
  preferHeight?: { min?: number, max?: number, weight?: number }
  preferSlope?: { min?: number, max?: number, weight?: number }
  avoidOverlap?: boolean
}
```

### –ü—Ä–∞–≤–∏–ª–∞ –∏ best practices
- –í `mode: 'auto'` —Ä–µ–∂–∏–º –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ `kind` (hill/dune/ridge ‚Üí add; basin/valley ‚Üí sub; plateau ‚Üí set; crater/terrace ‚Äî —Å–æ—Å—Ç–∞–≤–Ω—ã–µ).
- –î–ª—è `valley/basin` –Ω–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—É—é `intensity` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è; –∑–Ω–∞–∫ –∑–∞–¥–∞—ë—Ç—Å—è —Ä–µ–∂–∏–º–æ–º.
- `gridJitter.jitter` ‚Äî –¥–æ–ª—è –æ—Ç –ø–æ–ª–æ–≤–∏–Ω—ã —è—á–µ–π–∫–∏ (0..1), 1 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ–º—É —Å–º–µ—â–µ–Ω–∏—é –¥–æ ¬±cell/2 –ø–æ –∫–∞–∂–¥–æ–π –æ—Å–∏.
- –î–ª—è ¬´—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ¬ª —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ring` —Å `rMin‚âà0, rMax‚âà2` –∏ —Ü–µ–Ω—Ç—Ä–æ–º `[world.width/2, world.height/2]`.
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ –∑–Ω–∞—á–µ–Ω–∏—è—Ö (–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π `kind`, `placement.type`, `falloff` –∏–ª–∏ –ª–∏—à–Ω–∏–µ –∫–ª—é—á–∏ –≤ `bias`) –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±—Ä–æ—Å–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è.

### –ü—Ä–∏–º–µ—Ä—ã

```ts
const spec: GfxProceduralTerrainSpec = {
  world: { width: 240, height: 240, edgeFade: 0.1 },
  base: { seed: 3795, octaveCount: 5, amplitude: 8, persistence: 0.55, width: 96, height: 96 },
  pool: {
    global: { intensityScale: 1.0, maxOps: 80 },
    recipes: [
      { kind: 'hill', count: [20, 30], placement: { type: 'uniform' }, radius: [10, 18], intensity: [4, 9], falloff: 'smoothstep' },
      { kind: 'plateau', count: [2, 4], placement: { type: 'poisson', minDistance: 50 }, radius: [12, 18], intensity: [2, 4], falloff: 'linear' }
    ]
  },
  seed: 3795
}
```

