# –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Ä—Ä–µ–π–Ω–æ–≤ (–ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–µ —Å–ª–æ–∏)

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã—Ö —Å–ª–æ—ë–≤: –µ–¥–∏–Ω—ã–π —Å—ç–º–ø–ª–µ—Ä –≤—ã—Å–æ—Ç—ã, –ø–æ–¥–¥–µ—Ä–∂–∫—É PNG heightmap –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π —Ä–µ–ª—å–µ—Ñ–∞ (TerrainOps), –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ—Ä—Ä–µ–π–Ω–∞, –∞ —Ç–∞–∫–∂–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è UI.

---

## –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

- üß≠ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã: –≤—ã—Å–æ—Ç—ã –∏ –Ω–æ—Ä–º–∞–ª–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `GfxHeightSampler` –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏ –≤ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ, –∏ –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤. –£ —Å—ç–º–ø–ª–µ—Ä–∞ –µ—Å—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª: `isReady()`, `ready()`, `dispose()`.
- üñºÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PNG heightmap: –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ IndexedDB (Dexie), –±–∏–ª–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è —è—Ä–∫–æ—Å—Ç–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –≤—ã—Å–æ—Ç (Float32Array) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–µ–º–ø–ª–∏–Ω–≥–∞.
- üîÅ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –∫–∞—Ä—Ç—ã –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è –¥–æ ‚â§200px –ø–æ –±–æ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ, –∏–∑ –Ω–∏—Ö –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤—ã—Å–æ—Ç—ã –∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ö—ç—à; –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Ö—ç—à–∞ –∞—Å—Å–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–Ω–æ–≤—ã–π –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è).
- üß∞ TerrainOps: –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ–ª—å–µ—Ñ–∞ (add/sub/set) —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∑–∞—Ç—É—Ö–∞–Ω–∏—è –∏ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–æ–Ω–∞–º–∏ –≤–ª–∏—è–Ω–∏—è.
 - üß© –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –∏—Å—Ç–æ—á–Ω–∏–∫–∏, —Å–µ–º–ø–ª–∏–Ω–≥, —ç—Ñ—Ñ–µ–∫—Ç—ã, –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –∫—ç—à–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –ø–æ–¥ `src/features/scene/lib/terrain/`.
 - üß† –ö—ç—à–∏ —Å TTL/LRU: `assets/heightmapCache.ts` –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø–∞–º—è—Ç—å –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç `invalidate(assetId)`/`clear()`.
 

---

## UI: —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—è –ª–∞–Ω–¥—à–∞—Ñ—Ç–∞

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `src/features/scene/ui/objectManager/SceneLayerModals.tsx`

–ü–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è:

1. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–§–æ—Ä–º–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏¬ª ‚Üí –†–µ–ª—å–µ—Ñ–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å (—Ç–µ—Ä—Ä–µ–π–Ω)
2. –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Ä—Ä–µ–π–Ω–∞:
   - `Perlin` ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à—É–º
   - `Heightmap` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ PNG

### –°–æ–∑–¥–∞–Ω–∏–µ Perlin-—Ç–µ—Ä—Ä–µ–π–Ω–∞

1. –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ `Perlin`
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
   - **Seed** ‚Äî –∑–µ—Ä–Ω–æ –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (–ª—é–±–æ–µ —á–∏—Å–ª–æ)
   - **Octave Count** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤ —à—É–º–∞ (1-8, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3-5)
   - **Amplitude** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Ä–µ–ª—å–µ—Ñ–∞ (–æ–±—ã—á–Ω–æ 5-20)
   - **Persistence** ‚Äî –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ (0.1-0.8)
   - **Grid Width/Height** ‚Äî —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (16-128 —Å–µ–≥–º–µ–Ω—Ç–æ–≤)
3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:
   - **Edge Fade** ‚Äî –ø–ª–∞–≤–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –∫ –∫—Ä–∞—è–º (0.0-0.3)
   - **World Size** ‚Äî —Ä–∞–∑–º–µ—Ä—ã —Ç–µ—Ä—Ä–µ–π–Ω–∞ –≤ –º–∏—Ä–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö
4. –°–æ–∑–¥–∞–π—Ç–µ —Å–ª–æ–π ‚Üí –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ store

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ª–∞–Ω–¥—à–∞—Ñ—Ç–∞:**

- **–ì–æ—Ä—ã**: octaveCount=5-6, amplitude=15-25, persistence=0.6, grid=128x128
- **–•–æ–ª–º—ã**: octaveCount=3-4, amplitude=5-10, persistence=0.4, grid=64x64
- **–†–∞–≤–Ω–∏–Ω–∞**: octaveCount=2-3, amplitude=2-5, persistence=0.3, grid=32x32

### –°–æ–∑–¥–∞–Ω–∏–µ Heightmap-—Ç–µ—Ä—Ä–µ–π–Ω–∞

1. –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ `Heightmap`
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ PNG-—Ñ–∞–π–ª (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏:
   - **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ (min)** ‚Äî –≤—ã—Å–æ—Ç–∞ –¥–ª—è —á—ë—Ä–Ω—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π
   - **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ (max)** ‚Äî –≤—ã—Å–æ—Ç–∞ –¥–ª—è –±–µ–ª—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π
   - **–†–µ–∂–∏–º –∫—Ä–∞—ë–≤ (wrap)**: 
     - `clamp` ‚Äî –∫—Ä–∞–π–Ω–∏–µ –ø–∏–∫—Å–µ–ª–∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
     - `repeat` ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –ø–æ –∫—Ä–∞—è–º
4. –°–æ–∑–¥–∞–π—Ç–µ —Å–ª–æ–π ‚Üí PNG —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Dexie (—Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π –ø–æ —Ö—ç—à—É –≤—ã—Å–æ—Ç), —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è `GfxTerrainConfig` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ store

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- –¢–∏–ø—ã: —Å–º. `docs/api/types/terrain.md`
- –°—ç–º–ø–ª–µ—Ä: `src/features/scene/lib/terrain/GfxHeightSampler.ts`
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è heightmap: `src/features/scene/lib/terrain/HeightmapUtils.ts`
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥: `src/features/scene/ui/renderer/landscape/LandscapeLayer.tsx`
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤: `src/features/scene/lib/placement/ObjectPlacementUtils.ts`
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥–µ–æ–º–µ—Ç—Ä–∏–∏: `src/features/scene/lib/terrain/GeometryBuilder.ts` (`buildGfxTerrainGeometry`, `decideSegments`)
- –ú–æ–¥—É–ª–∏ —Ç–µ—Ä—Ä–µ–π–Ω–∞:
  - `heightSources/PerlinSource.ts`, `heightSources/HeightmapSource.ts`
  - `sampling/uv.ts`, `sampling/bilinear.ts`
  - `ops/spatialIndex.ts`, `ops/applyOps.ts`
  - `effects/edgeFade.ts`
  - `assets/heightmapCache.ts` (–∫—ç—à ImageData –∏ —á–∏—Å–ª–æ–≤–æ–≥–æ –ø–æ–ª—è –≤—ã—Å–æ—Ç, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è, TTL/LRU)

---

## üÜï –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∞–Ω–¥—à–∞—Ñ—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∏—Ç —Ç–µ—Ä—Ä–µ–π–Ω –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`GfxProceduralTerrainSpec`), –∏—Å–ø–æ–ª—å–∑—É—è:
- –±–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ Perlin —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —à—É–º–∞;
- –ø—É–ª —Ä–µ—Ü–µ–ø—Ç–æ–≤ (`GfxTerrainOpPool`) —Å –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π –∏ bias-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π;
- –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PRNG (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π seed ‚Üí –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç).

–ì–ª–∞–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫: `src/features/scene/lib/terrain/ProceduralTerrainGenerator.ts`.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ SceneAPI:
- `generateProceduralTerrain(spec)` ‚Äî —Å–æ–±—Ä–∞—Ç—å `GfxTerrainConfig`;
- `generateTerrainOpsFromPool(pool, seed, opts)` ‚Äî —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ `ops[]`;
- `createProceduralLayer(spec, layerData?)` ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å–ª–æ–π –∏ –≤—ã—Ä–æ–≤–Ω—è—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å—ã.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- `recipe.kind`: hill | basin | ridge | valley | crater | plateau | terrace | dune
- `placement.type`: uniform | poisson | gridJitter | ring
- `falloff`: smoothstep | gauss | linear

–í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö –ø–æ–ª–µ–π –±—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–∞ –ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π `placement.type` –∏–ª–∏ `recipe.kind`).

–ü—Ä–∏–º–µ—Ä (JavaScript):
```javascript
const spec = {
  world: { width: 240, height: 240, edgeFade: 0.1 },
  base: { seed: 3795, octaveCount: 5, amplitude: 8, persistence: 0.55, width: 96, height: 96 },
  pool: {
    global: { intensityScale: 1.0, maxOps: 80 },
    recipes: [
      { kind: 'hill', count: [20, 30], placement: { type: 'uniform' }, radius: [10, 18], intensity: [4, 9], falloff: 'smoothstep' },
      { kind: 'plateau', count: [2, 4], placement: { type: 'poisson', minDistance: 50 }, radius: [12, 18], intensity: [2, 4], falloff: 'linear' }
    ]
  },
  seed: 3795
}
const res = await SceneAPI.createProceduralLayer(spec, { name: '–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –ª–∞–Ω–¥—à–∞—Ñ—Ç', visible: true })
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–∏–ø–∞—Ö —Å–º. `docs/api/types/terrain.md` (—Ä–∞–∑–¥–µ–ª ¬´–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è¬ª).

---

## –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### recipe.kind ‚Äî —Ç–∏–ø—ã —Ä–µ—Ü–µ–ø—Ç–æ–≤ —Ä–µ–ª—å–µ—Ñ–∞

- hill:
  - –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: add (–ø–æ–¥–Ω–∏–º–∞–µ—Ç —Ä–µ–ª—å–µ—Ñ).
  - –û–¥–Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. `radius` ‚Äî –±–∞–∑–æ–≤—ã–π —Ä–∞–¥–∏—É—Å –ø–æ X, `aspect` –∑–∞–¥–∞—ë—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ Z (radiusZ = radius * aspect). `rotation` –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —ç–ª–ª–∏–ø—Å.
  - `intensity` ‚Äî –≤—ã—Å–æ—Ç–∞ –ø–æ–¥—ä—ë–º–∞. –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –º–æ–¥—É–ª—é, –∑–Ω–∞–∫ –∑–∞–¥–∞—ë—Ç—Å—è —Ä–µ–∂–∏–º–æ–º.

- basin:
  - –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: sub (–ø–æ–Ω–∏–∂–∞–µ—Ç —Ä–µ–ª—å–µ—Ñ).
  - –°–µ–º–∞–Ω—Ç–∏–∫–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–∫ —É hill, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç ¬´–≤—ã–µ–º–∫–∏¬ª.

- ridge:
  - –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: add.
  - –ï—Å–ª–∏ `step > 0` ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–µ—Ä–∏—è –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–ª–ª–∏–ø—Å–æ–≤ (¬´—à—Ç—Ä–∏—Ö–æ–≤¬ª) –≤–¥–æ–ª—å –ª–∏–Ω–∏–∏ —á–µ—Ä–µ–∑ `center` —Å —à–∞–≥–æ–º `step` –∏ —É–≥–ª–æ–º `rotation` (–∏–ª–∏ —Å–ª—É—á–∞–π–Ω—ã–º, –µ—Å–ª–∏ `rotation` –Ω–µ –∑–∞–¥–∞–Ω). –ò–Ω–∞—á–µ ‚Äî –æ–¥–∏–Ω —ç–ª–ª–∏–ø—Å –∫–∞–∫ —É hill.
  - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ–±–æ–ª—å—à–æ–π `aspect` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.2‚Äì0.4) –¥–ª—è –≤—ã—Ç—è–Ω—É—Ç—ã—Ö —Ö—Ä–µ–±—Ç–æ–≤.

- valley:
  - –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: sub.
  - –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ridge (—Å–µ—Ä–∏—è –ø—Ä–∏ `step > 0`), –Ω–æ –ø–æ–Ω–∏–∂–∞–µ—Ç –≤—ã—Å–æ—Ç—É (–¥–æ–ª–∏–Ω–∞).

- crater:
  - –°–æ—Å—Ç–∞–≤–Ω–æ–π —Ä–µ—Ü–µ–ø—Ç: —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –≤—ã–µ–º–∫–∞ (sub) + –≤–Ω–µ—à–Ω–∏–π –≤–∞–ª (add) –±–æ–ª—å—à–µ–≥–æ —Ä–∞–¥–∏—É—Å–∞ –∏ –º–µ–Ω—å—à–µ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏.
  - `falloff` —É–ø—Ä–∞–≤–ª—è–µ—Ç –º—è–≥–∫–æ—Å—Ç—å—é —Å—Ç–µ–Ω–æ–∫ –∫—Ä–∞—Ç–µ—Ä–∞.

- plateau:
  - –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: set (–ø—Ä–∏–ø–æ–¥–Ω—è—Ç–∞—è –ø–ª–æ—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞ —Å –ø–ª–∞–≤–Ω—ã–º –∫—Ä–∞–µ–º).
  - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `falloff: 'linear'` –¥–ª—è –±–æ–ª–µ–µ ¬´–ø–ª–æ—Å–∫–æ–π¬ª –≤–µ—Ä—à–∏–Ω—ã.

- terrace:
  - –°–æ—Å—Ç–∞–≤–Ω–æ–π —Ä–µ—Ü–µ–ø—Ç: –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—á–µ—Å–∫–∏—Ö ¬´–∫–æ–ª–µ—Ü‚Äë—Å—Ç—É–ø–µ–Ω–µ–π¬ª —Å —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∂–∏–º–æ–≤ (set/add) –∏ —É–º–µ–Ω—å—à–∞—é—â–µ–π—Å—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å—é –∫ –∫—Ä–∞—è–º.

- dune:
  - –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: add.
  - –û–¥–Ω–∞ —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∞—è ¬´–¥—é–Ω–∞¬ª. –î–ª—è –±–∞—Ä—Ö–∞–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `aspect < 1` –∏ `rotation`/–¥–∏–∞–ø–∞–∑–æ–Ω `rotation`.

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –î–ª—è `valley`/`basin` –Ω–µ –∑–∞–¥–∞–≤–∞–π—Ç–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—É—é `intensity` ‚Äî –∑–Ω–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ä–µ–∂–∏–º–æ–º.
- `jitter.center` –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —Å–¥–≤–∏–≥ —Ü–µ–Ω—Ç—Ä–æ–≤ –≤ –º–µ—Ç—Ä–∞—Ö.

### placement.type ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–æ–≤

- uniform:
  - –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –ø–æ –º–∏—Ä—É –∏–ª–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (`area`). –î–ª—è –∫—Ä—É–≥–ª–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ –¥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤–Ω—É—Ç—Ä—å.

- poisson:
  - –†–∞–∑—Ä–µ–∂—ë–Ω–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–µ–π `minDistance` –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ (dart throwing). –ò–∑–±–µ–≥–∞–µ—Ç —Å–∫—É—á–∏–≤–∞–Ω–∏—è.

- gridJitter:
  - –°–µ—Ç–∫–∞ —Å —è—á–µ–π–∫–æ–π `cell`. –í –∫–∞–∂–¥—É—é —è—á–µ–π–∫—É ‚Äî –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –≤–±–ª–∏–∑–∏ —Ü–µ–Ω—Ç—Ä–∞ —Å –¥—Ä–æ–∂–∞–Ω–∏–µ–º `jitter` (0..1) –æ—Ç –ø–æ–ª–æ–≤–∏–Ω—ã cell. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ `count` —Ç–æ—á–µ–∫.

- ring:
  - –ê–Ω–Ω—É–ª—é—Å –≤–æ–∫—Ä—É–≥ `center: [x, z]` —Å —Ä–∞–¥–∏—É—Å–æ–º –∏–∑ `[rMin..rMax]`. –£–≥–ª—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ; –Ω–µ–¥–æ–±–æ—Ä –¥–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏.
  - –î–ª—è ¬´—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ¬ª —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `rMin‚âà0, rMax‚âà2`.

### falloff ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—Ç—É—Ö–∞–Ω–∏—è

- smoothstep:
  - –ü–ª–∞–≤–Ω–∞—è –ø–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è t^2 (3 ‚àí 2t). –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –î–∞—ë—Ç —Å–≥–ª–∞–∂–µ–Ω–Ω—ã–µ –∫—Ä–∞—è.

- gauss:
  - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –≤–æ–∫—Ä—É–≥ –≤–µ—Ä—à–∏–Ω—ã. –í—ã—à–µ –ø–∏–∫, –±—ã—Å—Ç—Ä–µ–µ —Å–ø–∞–¥ –∫ –∫—Ä–∞—è–º. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è ¬´–æ—Å—Ç—Ä—ã—Ö¬ª —Ñ–æ—Ä–º.

- linear:
  - –õ–∏–Ω–µ–π–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ. –ö—Ä–∞—è –±–æ–ª–µ–µ ¬´–∂—ë—Å—Ç–∫–∏–µ¬ª. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–ª–∞—Ç–æ/—Å—Ç—É–ø–µ–Ω–µ–π.

### –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

–û–±—â–∏–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è:
- –î–ª–∏–Ω—ã (radius, radiusZ, minDistance, cell, rMin/rMax, step) ‚Äî –≤ –º–∏—Ä–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö (–º–µ—Ç—Ä–∞—Ö);
- –£–≥–ª—ã (rotation) ‚Äî –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö; –¥–∏–∞–ø–∞–∑–æ–Ω—ã rotation ‚Äî [min, max] –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö;
- –í—ã—Å–æ—Ç—ã/–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ ‚Äî –≤ –º–µ—Ç—Ä–∞—Ö (–∞–º–ø–ª–∏—Ç—É–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–ª—å–µ—Ñ–∞);
- –í—Å–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ [min, max] –∏ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ seed.

spec.world:
- width, height: —Ä–∞–∑–º–µ—Ä—ã –º–∏—Ä–∞ (X/Z). –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∏ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –≥–µ–æ–º–µ—Ç—Ä–∏–∏.
- edgeFade?: –¥–æ–ª—è (0..1), –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –∑–∞—Ç—É—Ö–∞–µ—Ç –≤—ã—Å–æ—Ç–∞ –∫ –∫—Ä–∞—è–º –º–∏—Ä–∞ (–º—è–≥–∫–∞—è —Ä–∞–º–∫–∞).

base (Perlin):
- seed: –∑–µ—Ä–Ω–æ —à—É–º–∞; –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∞—ë—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –±–∞–∑–æ–≤—É—é –∫–∞—Ä—Ç—É –≤—ã—Å–æ—Ç.
- octaveCount: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∫—Ç–∞–≤ (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è). –ë–æ–ª—å—à–µ = —Å–ª–æ–∂–Ω–µ–µ –∏ ¬´—à—É–º–Ω–µ–µ¬ª —Ä–µ–ª—å–µ—Ñ; –æ–±—ã—á–Ω–æ 3‚Äì6.
- amplitude: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–º–ø–ª–∏—Ç—É–¥–∞ –±–∞–∑–æ–≤–æ–≥–æ —Ä–µ–ª—å–µ—Ñ–∞ (–≤ –º–µ—Ç—Ä–∞—Ö).
- persistence: –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –∞–º–ø–ª–∏—Ç—É–¥—ã –º–µ–∂–¥—É –æ–∫—Ç–∞–≤–∞–º–∏ (0..1). –ú–µ–Ω—å—à–µ ‚Üí –±–æ–ª–µ–µ –≥–ª–∞–¥–∫–∏–π —Ä–µ–ª—å–µ—Ñ.
- width/height: —Ä–∞–∑–º–µ—Ä—ã —Ä–µ—à—ë—Ç–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —à—É–º–∞ (–≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö). –ú–µ–Ω—å—à–µ ‚Üí –∫—Ä—É–ø–Ω–µ–µ –¥–µ—Ç–∞–ª–∏.
- offset?: [dx, dz] (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Å–¥–≤–∏–≥ —É–∑–æ—Ä–∞ —à—É–º–∞ –±–µ–∑ —Å–º–µ–Ω—ã seed.

pool.global:
- intensityScale?: –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ recipes.
  - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π intensity —Ä–µ—Ü–µ–ø—Ç–∞. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è ¬´–æ–±—â–µ–≥–æ —É—Å–∏–ª–µ–Ω–∏—è/–æ—Å–ª–∞–±–ª–µ–Ω–∏—è¬ª —Ä–µ–ª—å–µ—Ñ–∞.
- maxOps?: –≤–µ—Ä—Ö–Ω–∏–π –ø—Ä–µ–¥–µ–ª –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–ø–∞–¥—ë—Ç –≤ –∏—Ç–æ–≥–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–ø–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç–∫–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∏ bias‚Äë—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏).

recipe (–æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è):
- kind: —Ç–∏–ø —Ä–µ–ª—å–µ—Ñ–∞ (—Å–º. –≤—ã—à–µ); –∑–∞–¥–∞—ë—Ç —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–µ–∑ mode='auto'.
- mode?: 'auto' | 'add' | 'sub' | 'set' ‚Äî –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º, –∏–Ω–∞—á–µ –±–µ—Ä—ë—Ç—Å—è –∏–∑ kind.
- count: —á–∏—Å–ª–æ —Ü–µ–Ω—Ç—Ä–æ–≤ –¥–ª—è —Ä–µ—Ü–µ–ø—Ç–∞. –ú–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º [min, max] (—Ü–µ–ª–æ–µ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ).
- placement: —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–æ–≤ (—Å–º. –Ω–∏–∂–µ).
- radius: –±–∞–∑–æ–≤—ã–π —Ä–∞–¥–∏—É—Å –≤–¥–æ–ª—å X. –ú–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º.
- aspect?: –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–æ–≤ –ø–æ Z/X. –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º. radiusZ = radius * aspect.
- intensity: –∞–º–ø–ª–∏—Ç—É–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã (–º). –ú–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º.
  - –ó–Ω–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è mode (–¥–≤–∏–∂–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ); –¥–ª—è valley/basin —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞.
- rotation?: —É–≥–æ–ª –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω —É–≥–ª–æ–≤ (—Ä–∞–¥–∏–∞–Ω—ã). –î–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —ç–ª–ª–∏–ø—Å–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é; –¥–ª—è ridge/valley ‚Äî –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à—Ç—Ä–∏—Ö–∞, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω step.
- falloff?: 'smoothstep' | 'gauss' | 'linear' ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –∑–∞—Ç—É—Ö–∞–Ω–∏—è –ø–æ –∫—Ä–∞—è–º –≤–ª–∏—è–Ω–∏—è (—Å–º. –≤—ã—à–µ).
- bias?: –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ —Ä–µ–ª—å–µ—Ñ—É (—Å–º. –Ω–∏–∂–µ).
- jitter?: { center?: number } ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π —Å–¥–≤–∏–≥ —Ü–µ–Ω—Ç—Ä–æ–≤ (–º) –≤–æ–∫—Ä—É–≥ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–æ—á–∫–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è.
- step?: —á–∏—Å–ª–æ (–º) ‚Äî –¥–ª—è ridge/valley —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Ä–∏—é —ç–ª–ª–∏–ø—Å–æ–≤ –≤–¥–æ–ª—å –ª–∏–Ω–∏–∏ —á–µ—Ä–µ–∑ center; –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ step —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —ç–ª–ª–∏–ø—Å.

placement (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã):
- uniform: –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚Äî —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Å–ª—É—á–∞–π–Ω–æ–µ –ø–æ –º–∏—Ä—É/–æ–±–ª–∞—Å—Ç–∏.
- poisson: { minDistance } ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ü–µ–Ω—Ç—Ä–∞–º–∏ (–º).
- gridJitter: { cell, jitter? } ‚Äî —Ä–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ (–º) –∏ –¥—Ä–æ–∂–∞–Ω–∏–µ 0..1 (—Å–º–µ—â–µ–Ω–∏–µ –¥–æ ¬±cell/2 –ø–æ –∫–∞–∂–¥–æ–π –æ—Å–∏).
- ring: { center: [x, z], rMin, rMax } ‚Äî —Ü–µ–Ω—Ç—Ä –∏ –¥–∏–∞–ø–∞–∑–æ–Ω —Ä–∞–¥–∏—É—Å–æ–≤ (–º). rMax ‚â• rMin ‚â• 0.

bias:
- preferHeight?: { min?, max?, weight? } ‚Äî –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã—Å–æ—Ç (–º). weight ‚àà [0..1] ‚Äî —Å–∏–ª–∞ –≤–ª–∏—è–Ω–∏—è.
- preferSlope?: { min?, max?, weight? } ‚Äî –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª —É–∫–ª–æ–Ω–æ–≤ (—Ä–∞–¥–∏–∞–Ω—ã). –¢—Ä–µ–±—É–µ—Ç sampler –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–æ—Ä–º–∞–ª–µ–π.
- avoidOverlap?: boolean ‚Äî –∏—Å–∫–ª—é—á–∞—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –º–µ–∂–¥—É —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ (–∂–∞–¥–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ —É–±—ã–≤–∞–Ω–∏—é –≤–µ—Å–∞).

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–¥–ª—è generateTerrainOpsFromPool):
- worldWidth/worldHeight: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã, –µ—Å–ª–∏ –Ω–µ–ª—å–∑—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∑—è—Ç—å –∏–∑ —Å–ª–æ—è.
- area?: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: { kind: 'rect' | 'circle', ... }.
- sampler?: –≤–Ω–µ—à–Ω–∏–π GfxHeightSampler ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å preferHeight/preferSlope –∏ –∏–∑–±–µ–≥–∞—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–µ–ª—å–µ—Ñ–æ–º —Ç–æ—á–Ω–µ–µ.

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —Ç–µ—Ä—Ä–µ–π–Ω–æ–≤

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Perlin

```ts
import type { GfxTerrainConfig } from '@/entities/terrain'

// –ì–æ—Ä–Ω—ã–π –ª–∞–Ω–¥—à–∞—Ñ—Ç —Å –≤—ã—Å–æ–∫–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
const perlinMountains: GfxTerrainConfig = {
  worldWidth: 250,
  worldHeight: 250,
  edgeFade: 0.2,
  source: {
    kind: 'perlin',
    params: {
      seed: 42,
      octaveCount: 6,    // –º–Ω–æ–≥–æ —Å–ª–æ—ë–≤ –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ —Ä–µ–ª—å–µ—Ñ–∞
      amplitude: 18.0,   // –≤—ã—Å–æ–∫–∏–µ –ø–∏–∫–∏
      persistence: 0.55, // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π
      width: 128,        // –≤—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
      height: 128
    }
  },
  ops: [
    // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤
    {
      id: 'main-ridge',
      mode: 'add',
      center: [125, 125],
      radius: 60,
      intensity: 8.0,
      falloff: 'smoothstep'
    },
    // –î–æ–ª–∏–Ω–∞-–ø—Ä–æ—Ö–æ–¥
    {
      id: 'valley-pass',
      mode: 'sub',
      center: [100, 150],
      radius: 25,
      radiusZ: 40,
      rotation: Math.PI / 3,
      intensity: 6.0,
      falloff: 'gauss'
    }
  ]
}

// –ü–ª–∞–≤–Ω—ã–µ —Ö–æ–ª–º—ã –¥–ª—è –ø–∞—Å—Ç–æ—Ä–∞–ª—å–Ω–æ–≥–æ –ª–∞–Ω–¥—à–∞—Ñ—Ç–∞
const perlinHills: GfxTerrainConfig = {
  worldWidth: 180,
  worldHeight: 180,
  edgeFade: 0.1,
  source: {
    kind: 'perlin',
    params: {
      seed: 777,
      octaveCount: 3,    // –º–∞–ª–æ —Å–ª–æ—ë–≤ = –ø–ª–∞–≤–Ω–æ—Å—Ç—å
      amplitude: 6.0,    // –Ω–µ–≤—ã—Å–æ–∫–∏–µ —Ö–æ–ª–º—ã
      persistence: 0.35, // –±—ã—Å—Ç—Ä–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π
      width: 48,         // –Ω–∏–∑–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ = –º—è–≥–∫–∏–µ —Ñ–æ—Ä–º—ã
      height: 48
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Heightmap

```ts
import type { GfxTerrainConfig } from '@/entities/terrain'

const heightmapTerrain: GfxTerrainConfig = {
  worldWidth: 120,
  worldHeight: 120,
  edgeFade: 0.15,
  source: {
    kind: 'heightmap',
    params: {
      assetId: 'dexie-asset-id',
      imgWidth: 2048,
      imgHeight: 2048,
      min: -2,           // –≥–ª—É–±–∏–Ω–∞ –≤–æ–¥–æ—ë–º–æ–≤
      max: 12,           // –≤—ã—Å–æ—Ç–∞ –≤–µ—Ä—à–∏–Ω
      wrap: 'clamp'      // —Ä–∞—Å—Ç—è–Ω—É—Ç—å –∫—Ä–∞—è
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—ç–º–ø–ª–µ—Ä–∞ –∏ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –≤ —Ä–µ–Ω–¥–µ—Ä–µ

```ts
import { createGfxHeightSampler } from '@/features/scene/lib/terrain/GfxHeightSampler'
import { buildGfxTerrainGeometry } from '@/features/scene/lib/terrain/GeometryBuilder'

const sampler = createGfxHeightSampler(cfg)
await sampler.ready?.() // –¥–ª—è heightmap –¥–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
const geometry = buildGfxTerrainGeometry(cfg, sampler)
```

---

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ –º–∏–≥—Ä–∞—Ü–∏—è

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –ø–æ–ª—è `noiseData` —É–¥–∞–ª–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `terrain: GfxTerrainConfig`.
- Scene API –º–µ—Ç–æ–¥ `adjustInstancesForPerlinTerrain` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ —Ç–µ—Ä—Ä–µ–π–Ω–æ–≤ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

### –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–µ–π

- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –∞—Å—Å–µ—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `invalidate(assetId)` –∏–∑ `assets/heightmapCache.ts` (–∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç—Å—è –≤ `HeightmapUtils.ts`).

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ö—ç—à –∑–Ω–∞—á–µ–Ω–∏–π –≤—ã—Å–æ—Ç –≤ `GfxHeightSampler` —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.
- –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å —É–º–µ–Ω—å—à–∞–µ—Ç —á–∏—Å–ª–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ `TerrainOps`.
- –ì–µ–æ–º–µ—Ç—Ä–∏—è –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏/–∑–∞–≥—Ä—É–∑–∫–µ ImageData.
- –í—ã—Å–æ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Dexie –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –ø–æ —Ö—ç—à—É ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö PNG –Ω–µ —Å–æ–∑–¥–∞—é—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.
- –í `assets/heightmapCache.ts` –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è TTL/LRU –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–∞–º—è—Ç–∏; –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã `invalidate(assetId)` –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π `clear()`.

