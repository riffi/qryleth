# Agent Tasks / Агентские задачи

Документ описывает, как агенты создают и выполняют задачи, когда пользователь явно просит «сделай агентскую задачу».

> **TL;DR**  
> Работа оформляется цепочкой *эпик → задача → фазы* (или сразу «задача → фазы», если эпик не нужен).  
> Каждая фаза должна оставлять репозиторий в рабочем состоянии.  
> Перед стартом агент обязан открыть **agent-tasks.md** и свериться с [арх-принципами](../../architecture/design-principles.md).  
> Фазы могут выполнять разные агенты.

---

## 1. Термины

| Термин     | Что это                                                         |
|------------|-----------------------------------------------------------------|
| **Epic**   | Верхнеуровневая цель; агрегирует связанные задачи.             |
| **Task**   | Папка с `AGENT_TASK_SUMMARY.md` и подпапкой `phases/`.          |
| **Phase**  | Изолированный шаг задачи (≤ 15 изменённых файлов; сборка = зелёная). |

---

## 2. Файловая структура

```text
agent-tasks/
├─ epics/
│  └─ backend-integration/
│     ├─ epic.md
│     └─ tasks/
│        └─ auth-endpoints/
│           ├─ AGENT_TASK_SUMMARY.md
│           └─ phases/
│              └─ phase_1_summary.md
├─ tasks/                 # задачи, НЕ привязанные к эпикам
│  └─ fix-modal-scroll/…
└─ agent-tasks.md
```

---

## 3. Workflow

### 3.0 Epic-flow

| Шаг               | Действие                                                                                                                |
|-------------------|-------------------------------------------------------------------------------------------------------------------------|
| **Создание**      | `epics/<slug>/epic.md` с YAML-шапкой:<br>`status: planned / in-progress / done`<br>`created: 2025-08-07`<br>`tags:` … |
| **Содержимое**    | Цель, KPI, high-level-вехи, ссылка на дизайн-док (если есть) + статус выполнения.                                       |
| **Привязка задач**| Каждая дочерняя задача хранится в `epics/<slug>/tasks/` и имеет `epic: ../epic.md` в YAML-шапке.                        |
| **Закрытие**      | После завершения всех задач агент ставит `status: done` в `epic.md` и создает `EPIC_REPORT.md` (сводка).                |

---

### 3.1 Создание новой задачи

| Шаг | Действие                                                                                                       |
|-----|----------------------------------------------------------------------------------------------------------------|
| 1   | Создать папку `tasks/<slug>/` **или** `epics/<epic>/tasks/<slug>/`.                                            |
| 2   | Добавить `AGENT_TASK_SUMMARY.md` с YAML:<br>`epic: ../epic.md # или null`<br>`status: planned`<br>`created:` … |
| 3   | Провести экспресс-аудит кода (чтобы не дублировать работу ранее выполненных фаз).                              |
| 4   | В теле файла описать контекст, цели, **список фаз** (см. 3.3).                                                 |
| 5   | При необходимости включить фазу «Обновить документацию».                                                       |

---

### 3.2 Выполнение фазы

1. Найти папку задачи, прочитать `AGENT_TASK_SUMMARY.md` + предыдущие `phase_*_summary.md`.
2. Если планируемый diff **больше чем 15 файлов** → самостоятельно разбить фазу, обновить список фаз и выполнить только первую часть.
3. По завершении:
   * создать `phases/phase_<N>_summary.md` (итоги + контекст для следующих фаз);
   * пометить фазу «✅ Выполнено» в `AGENT_TASK_SUMMARY.md`;
   * при необходимости скорректировать будущие фазы.

---

### 3.3 Правила разбиения на фазы

| Правило                              | Пояснение                                                         |
|--------------------------------------|-------------------------------------------------------------------|
| ≤ 15 изменённых файлов               | Дробим крупные изменения.                                         |
| Сборка / линт / тесты — зелёные      | Обязательно после каждой фазы.                                    |
| Однотипные изменения → отдельные фазы| Например, UI-фиксы и backend-логика отдельно.                     |
| Формат постановки                    | Каждая фаза — конкретная доработка; код должен оставаться валидным.|

---

### 3.4 Завершение задачи

| Шаг | Действие                                                                                         |
|-----|--------------------------------------------------------------------------------------------------|
| 1   | Создать `TASK_COMPLETION_REPORT.md` (консолидированная сводка + ссылки на все `phase_*`).        |
| 2   | Изменить `status:` в YAML задачи на `done`.                                                      |
| 3   | Если задача принадлежит эпику — проверить, можно ли закрыть эпик (см. 3.0).                       |

---

## 4. Чек-лист агента

| Обязанность                                           | ✓/✗ |
|-------------------------------------------------------|-----|
| Перед началом фазы перечитать `agent-tasks.md`        | ✓   |
| Держать сборку зелёной после фазы                     | ✓   |
| Обновлять доки при изменении публичных API            | ✓   |
| Менять > 15 файлов в одной фазе                       | ✗   |
| Удалять историю задач или фаз                         | ✗   |

---

## 5. Связанные документы

- [Design Principles](../../architecture/design-principles.md)
- [LLM Integration](../../features/ai-integration/llm-integration.md)
