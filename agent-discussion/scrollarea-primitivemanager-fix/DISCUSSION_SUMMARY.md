# Обсуждение: Проблема с ScrollArea в PrimitiveManager

## Постановка задачи
В PrimitiveManager есть ScrollArea, но она не работает корректно - при большом количестве элементов не появляется вертикальная прокрутка.

## Мысли агента 1

### Анализ текущей реализации
Изучив код `PrimitiveManager.tsx:192`, я вижу следующую структуру:
```tsx
<ScrollArea style={{ flex: 1 }} p="sm">
  <Stack gap="xs">
    {primitives.map((primitive, index) => (
      <PrimitiveItem ... />
    ))}
  </Stack>
</ScrollArea>
```

### Выявленные проблемы
1. **Отсутствие явной высоты**: ScrollArea использует `flex: 1`, но может не получать корректную высоту от родителя
2. **Неопределенность высоты контейнера**: Родительский Stack имеет `height: '100%'`, но без четкого определения максимальной высоты ScrollArea может не понимать когда активировать прокрутку
3. **Потенциальные проблемы с flex-контейнером**: Mantine ScrollArea может требовать более явного задания размеров

### Предлагаемые решения
1. **Добавить explicit высоту**: Задать ScrollArea конкретную высоту или использовать `viewportProps` с `style={{ maxHeight: 'calc(100vh - 200px)' }}`
2. **Использовать ScrollArea.Autosize**: Mantine предоставляет ScrollArea.Autosize для автоматического определения высоты
3. **Проверить родительские контейнеры**: Убедиться что Paper и Stack корректно определяют свою высоту
4. **Добавить `scrollbars="y"`**: Явно указать что нужна только вертикальная прокрутка

### Рекомендуемый подход
Я рекомендую начать с варианта ScrollArea.Autosize с заданием maxHeight, так как это наиболее гибкое решение:
```tsx
<ScrollArea.Autosize 
  mah="calc(100vh - 200px)" 
  style={{ flex: 1 }}
  scrollbars="y"
  p="sm"
>
```

Также стоит проверить, правильно ли задана высота родительского Paper компонента в месте использования PrimitiveManager.

## Мысли агента 2

### Дополнительный анализ реализации

При проверке контейнера, в котором используется `PrimitiveManager`, обнаружено, что
в файле `ObjectManagementPanel.tsx` строка высоты задаётся как
`height: 'calc(100vh-60px)'`. В выражениях `calc` оператор `-` должен быть
окружён пробелами. Из‑за отсутствия пробелов свойство `height` игнорируется
браузером, поэтому контейнер растягивается по содержимому, и `ScrollArea` не
получает ограниченную высоту, из‑за чего не появляется вертикальная прокрутка.

### Предлагаемое исправление

Задать корректное выражение высоты в контейнере:

```tsx
<Box
    style={{
      width: "100%",
      height: 'calc(100vh - 60px)',
      display: 'flex',
      flexDirection: 'column',
      overflow: 'hidden',
    }}
>
```

После фикса высоты `ScrollArea` c `flex: 1` внутри `PrimitiveManager`
должен корректно активировать вертикальную прокрутку. При необходимости можно
дополнительно использовать `ScrollArea.Autosize`, как предлагал агент 1, но это
уже не критично.

## Мысли агента 3 (Анализирующий)

### Анализ качества диагностики

**Агент 1** продемонстрировал системный подход, предложив несколько гипотез:
- Проблемы с определением высоты ScrollArea
- Вопросы flex-контейнера
- Неопределенность высоты родительского контейнера

**Агент 2** провел более глубокий анализ контекста и обнаружил корневую причину проблемы.

### Подтверждение диагноза

Проверил код в `ObjectManagementPanel.tsx:23` - диагноз агента 2 **абсолютно корректен**:
```css
height: 'calc(100vh-60px)' // Ошибка: отсутствуют пробелы вокруг оператора -
```

В CSS `calc()` арифметические операторы `+` и `-` должны быть окружены пробелами. Без них браузер игнорирует свойство, контейнер растягивается по содержимому, ScrollArea не получает ограниченную высоту.

### Оценка процесса обсуждения

Отличный пример коллективного решения проблем:
1. Первый агент - широкий анализ возможных причин на уровне компонента
2. Второй агент - углубленный анализ контекста, поиск корневой причины
3. Демонстрирует важность многоуровневого анализа

## Комментарий пользователя
Добавил пробелы вокруг "-", но прокрутка так и не появилась

## Мысли агента 4

### Анализ после обратной связи

Исправление выражения `calc(100vh - 60px)` устранило синтаксическую ошибку,
но вертикальная прокрутка по‑прежнему не активируется. Причина в том, что
контейнеры в цепочке `Box → Tabs.Panel → PrimitiveManager` используют
flex‑раскладку, где элементы с `flex: 1` имеют `min-height: auto` и не могут
сжиматься. В результате `ScrollArea` растягивается по содержимому и не
получает ограниченную высоту.

### Предлагаемое решение

Разрешить `ScrollArea` занимать свободное место, добавив `minHeight: 0`
в контейнеры вкладок:

```tsx
<Tabs.Panel
    value="primitives"
    style={{ flex: 1, display: 'flex', overflow: 'hidden', minHeight: 0 }}
>
  <PrimitiveManager />
</Tabs.Panel>
```

Аналогичное изменение требуется для панели материалов. При необходимости
можно также добавить `minHeight: 0` в `Stack` и саму `ScrollArea` внутри
`PrimitiveManager`.

## Комментарий пользователя
Добавил minHeight: 0 в обе Tabs.Panel, в `Stack` и саму `ScrollArea` внутри
`PrimitiveManager`, но полоса прокрутки так и не появилась

## Консенсус

Проблема имеет две составляющие: синтаксическая ошибка в выражении `calc()` и
отсутствие `minHeight: 0` в родительских flex‑контейнерах. Для появления
вертикальной прокрутки необходимо исправить выражение высоты и явно разрешить
детям с `flex: 1` уменьшаться.

## Постановка для исполнения

**Задача**: Обеспечить появление вертикальной прокрутки в `PrimitiveManager`

**Файлы**:
- `src/features/object-editor/ui/ObjectManagementPanel/ObjectManagementPanel.tsx`
- при необходимости `src/features/object-editor/ui/PrimitiveManager/PrimitiveManager.tsx`

**Изменения**:
- Использовать корректное выражение высоты `height: 'calc(100vh - 60px)'`
- Добавить `minHeight: 0` в стилях `Tabs.Panel` для вкладок `primitives` и `materials`
- При необходимости добавить `minHeight: 0` в `Stack` и `ScrollArea` внутри `PrimitiveManager`

**Критерии готовности**:
- Контейнер панели ограничен по высоте и не растягивается по содержимому
- При большом количестве примитивов появляется вертикальная прокрутка
- Существующая верстка остальных элементов не ломается

