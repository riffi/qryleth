---
id: 28
phase: 4
title: "Фаза 4: Стратифицированные биомы — Итерация 1 (GfxBiomeStratum & GfxBiomePlacementRule)"
status: done
created: 2025-09-02
updated: 2025-09-02
filesChanged: 2
---

# Фаза 4: Стратифицированные биомы — Итерация 1 (скелет)

## Что сделано
- Добавлены доменные типы стратифицированных биомов:
  - `apps/qryleth-front/src/entities/biome/model/types.ts`
    - `GfxBiomeStratum` — стратум биома, содержит `rules`.
    - `GfxBiomePlacementRule` — правило размещения (скелет, без локальных параметров).
    - `GfxBiome` дополнен полем `strata?: GfxBiomeStratum[]` (опционально для обратной совместимости).
- Обновлён оркестратор скаттеринга для поддержки стратификации:
  - `apps/qryleth-front/src/features/scene/lib/biomes/BiomeScattering.ts`
    - `scatterBiomePure(...)` теперь умеет работать как в плоском режиме, так и с `strata`.
    - Итерация 1: равномерно распределяем глобальную плотность `densityPer100x100` по всем правилам всех страт, вызывая существующий семплинг и суммируя placements.

## Примечания
- На этой итерации все правила используют глобальные параметры биома; локальные параметры будут добавлены в следующей фазе.
- Страта/правила служат для структурирования и подготовки к локальным настройкам.
- Вся математика и типы — через shared; функции остаются чистыми.

## Следующие шаги
- Фаза 5: локальные параметры `GfxBiomePlacementRule` (density/edge/transform + детерминизм seed per rule).
- Фаза 6: локальный выбор источников per rule.

