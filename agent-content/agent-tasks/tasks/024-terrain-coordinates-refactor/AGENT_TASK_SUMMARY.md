---
id: 24
epic: null
title: "Рефакторинг координатной системы террейна"
status: planned
created: 2025-08-27
updated: 2025-08-27
owner: team-ui
tags: [refactoring, types, coordinates, terrain, documentation, breaking-change]
phases:
  total: 6
  completed: 0
---

# Рефакторинг координатной системы террейна

## Обязательная информация
!Правила работы с агентскими задачами: [agent-tasks.md](../../../../docs/development/workflows/agent-tasks.md)
**ВАЖНО**: При выполнении каждой из фаз необходимо обязательно сверяться с требованиями и принципами из указанного файла.

## Цели
Переименование параметров координатной системы террейна для устранения путаницы между вертикальной высотой и глубиной по оси Z, а также исправление всех примеров и документации для правильного размещения объектов относительно центра мира.

## Контекст
**Проблема**: Текущие названия полей сбивают с толку разработчиков:
- `world.height` означает размер по оси Z (глубина), а не по оси Y (высота)
- `area.height` в прямоугольной области также означает размер по Z, что противоречит интуиции
- Примеры в scriptingPanel используют неправильные координаты, размещая объекты за пределами видимой области мира

**Координатная система террейна**:
- Мир имеет центр в [0, 0, 0]
- При размерах world: `{width: 300, height: 200}` реальные пределы: X [-150, +150], Z [-100, +100]
- Y - вертикальная ось (высота террейна над/под уровнем)
- Z - ось глубины (ближе-дальше от наблюдателя)

**Технические последствия**:
- Пользователи задают координаты типа `z: 160` для области размещения, но пределы мира только [-100, +100]
- Объекты генерируются вне видимой области и не отображаются
- Документация не объясняет принцип центрирования координат

## Список фаз

### ⏳ Фаза 1: Рефакторинг типов с обратной совместимостью
- Переименовать `world.height` → `world.depth` в `GfxProceduralTerrainSpec`
- Переименовать `area.height` → `area.depth` в `GfxPlacementArea`
- Добавить deprecated поля `height` с маркировкой `@deprecated`
- Обновить комментарии для ясности координатной системы
- Добавить JSDoc с примерами правильных координат

### ⏳ Фаза 2: Обновление кода обработки
- Обновить `ProceduralTerrainGenerator.ts` для поддержки новых полей
- Модифицировать функции размещения `PlacementUtils.ts` и `PlacementAlgorithms.ts`
- Заменить все использования `worldHeight` → `worldDepth` в коде
- Добавить fallback логику для deprecated полей
- Обеспечить работу тестов с новой логикой

### ⏳ Фаза 3: Исправление примеров в scriptingPanel
- Найти все файлы с примерами процедурной генерации террейна
- Исправить координаты областей размещения (относительно центра мира)
- Заменить `height` на `depth` во всех примерах
- Добавить комментарии с объяснением координатной системы
- Создать набор готовых шаблонов для разных сценариев размещения

### ⏳ Фаза 4: Создание новых тестов и валидация
- Создать comprehensive тесты для проверки правильности координат
- Протестировать размещение в разных частях мира (север/центр/юг)
- Добавить тесты для проверки обратной совместимости
- Убедиться что визуализация работает корректно во всех случаях
- Добавить валидацию координат с понятными сообщениями об ошибках

### ⏳ Фаза 5: Обновление документации
- Создать диаграмму координатной системы террейна с примерами
- Написать миграционную документацию для существующего кода
- Обновить README с подробным объяснением координатной системы
- Добавить секцию "Частые ошибки" с примерами решений
- Обновить комментарии в коде с актуальными примерами

### ⏳ Фаза 6: Обновить основную проектную документацию docs
- Обновить документацию по системе террейна
- Добавить гид по миграции в docs/
- Обновить архитектурные документы при необходимости
- Проверить актуальность всех ссылок и примеров