# Агентская задача: Приведение features/object-editor к методологии FSD

> **ВАЖНО:** При выполнении каждой фазы обязательно сверяйтесь с требованиями из [agent-tasks.md](../../docs/development/workflows/agent-tasks.md)

## Контекст задачи

Необходимо привести модуль `features/object-editor` в соответствие с принципами Feature-Sliced Design (FSD), применяемыми в проекте Qryleth.

### Текущая структура object-editor:
```
src/features/object-editor/
├─ r3f/                          # React Three Fiber компоненты
│  ├─ ObjectScene3D.tsx
│  ├─ ObjectSceneContent.tsx
│  ├─ controls/
│  │  └─ PrimitiveTransformGizmo.tsx
│  ├─ lighting/
│  │  └─ ObjectSceneLighting.tsx
│  └─ objects/
│     └─ ObjectScenePrimitives.tsx
├─ store/                        # Zustand store
│  └─ objectStore.ts
└─ ui/                          # UI компоненты
   └─ ObjectEditorR3F.tsx
```

### Целевая FSD структура (согласно design-principles.md):
```
src/features/object-editor/
├─ model/        # Состояние и бизнес-логика (zustand stores, селекторы)
├─ ui/           # React-компоненты, сгруппированные по назначению
├─ lib/          # Чистые вспомогательные функции
├─ api/          # Функции для работы с сервером (если есть)
└─ index.ts      # Публичный API фичи
```

### Проблемы текущей структуры:
1. Отсутствует публичный API (`index.ts`)
2. Папка `r3f/` не соответствует FSD - должна быть в `ui/`
3. Store находится в отдельной папке `store/` вместо `model/`
4. Нет разделения на сегменты согласно FSD
5. Отсутствует изоляция модуля

## План выполнения задачи

### Фаза 1: Создание публичного API и подготовка структуры
**Статус:** Выполнено

**Описание:** 
- Создать файл `src/features/object-editor/index.ts` с публичным API
- Подготовить новую структуру папок согласно FSD
- Создать папки `model/`, обновить `ui/`

**Планируемые изменения:**
- Создание `index.ts`
- Создание папки `model/`

### Фаза 2: Реорганизация store в model сегмент
**Статус:** Выполнено

**Описание:**
- Переместить `store/objectStore.ts` в `model/objectStore.ts`
- Обновить все импорты store в проекте
- Создать `model/index.ts` для экспорта store

**Планируемые изменения:**
- Перемещение `store/objectStore.ts` → `model/objectStore.ts`
- Создание `model/index.ts`
- Обновление импортов в:
  - `src/features/object-editor/ui/ObjectEditorR3F.tsx`
  - `src/hooks/objectEditor/useOEPrimitiveSelection.ts`
  - Другие файлы, использующие objectStore

**Результаты:** см. [Фаза 2](phases/phase_2_summary.md)

### Фаза 3: Реорганизация R3F компонентов в ui сегмент 
**Статус:** Ожидает выполнения

**Описание:**
- Переместить все компоненты из `r3f/` в `ui/`
- Сохранить логическую группировку (controls, lighting, objects)
- Обновить все импорты R3F компонентов

**Планируемые изменения:**
- Перемещение `r3f/ObjectScene3D.tsx` → `ui/ObjectScene3D.tsx`
- Перемещение `r3f/ObjectSceneContent.tsx` → `ui/ObjectSceneContent.tsx`
- Перемещение `r3f/controls/` → `ui/controls/`
- Перемещение `r3f/lighting/` → `ui/lighting/`
- Перемещение `r3f/objects/` → `ui/objects/`
- Создание `ui/index.ts` для экспорта компонентов
- Обновление импортов в файлах, использующих эти компоненты

### Фаза 4: Создание lib сегмента (если необходимо) 
**Статус:** Ожидает выполнения

**Описание:**
- Проанализировать код на наличие чистых вспомогательных функций
- При необходимости выделить утилиты в `lib/` сегмент
- Создать соответствующие экспорты

**Планируемые изменения:**
- Анализ кода на наличие утилитных функций
- Создание `lib/` при необходимости
- Обновление импортов при выделении утилит

### Фаза 5: Финализация публичного API и тестирование 
**Статус:** Ожидает выполнения

**Описание:**
- Завершить настройку `index.ts` с экспортом всех публичных сущностей
- Проверить, что все импорты из object-editor используют публичный API
- Убедиться, что приложение собирается и работает корректно
- Удалить пустые папки старой структуры

**Планируемые изменения:**
- Завершение `index.ts`
- Проверка и исправление всех импортов
- Тестирование сборки и работоспособности
- Очистка от старых папок

## Принципы реализации

1. **Изоляция модуля:** Все импорты из object-editor должны идти через `index.ts`
2. **Правило доступа слоев:** Соблюдать иерархию FSD (model → ui → lib)
3. **Сохранение функциональности:** Приложение должно работать после каждой фазы
4. **Группировка по назначению:** В ui/ группировать компоненты логически

## Связанные файлы

- [Agent Tasks](../../docs/development/workflows/agent-tasks.md) - Процесс выполнения агентских задач
- [Design Principles](../../docs/architecture/design-principles.md) - Архитектурные принципы
- [Feature-Sliced Design](../../docs/architecture/feature-sliced-design.md) - Руководство по FSD

## Статус выполнения фаз
- [x] **Фаза 1**: Создание публичного API и подготовка структуры - Выполнено
- [x] **Фаза 2**: Реорганизация store в model сегмент - Выполнено
- [ ] **Фаза 3**: Реорганизация R3F компонентов в ui сегмент
- [ ] **Фаза 4**: Создание lib сегмента (если необходимо)
- [ ] **Фаза 5**: Финализация публичного API и тестирование

## Ссылки на выполненные фазы
- [Фаза 1](phases/phase_1_summary.md)
- [Фаза 2](phases/phase_2_summary.md)
