# Фаза 2: Рефакторинг ObjectEditor layout

**Статус**: ✅ Выполнено  
**Приоритет**: Высокий  
**Фактическое время**: ~1 час

## Цель фазы
Подготовка UI ObjectEditor для интеграции системы переключаемых панелей и создание нового layout компонента.

## Выполненные задачи

### ✅ 2.1 Создан ObjectEditorLayout компонент
**Файл**: `src/features/object-editor/ui/ObjectEditorLayout/ObjectEditorLayout.tsx`

**Ключевые особенности:**
- Поддержка переключаемых панелей (левая и правая)
- Интеграция PanelToggleButtons в header
- Логика взаимоисключающих левых панелей (чат vs свойства)
- Автоматическое переключение на свойства при выборе примитива/материала
- Поддержка передачи компонента чата через props
- Гибкая архитектура для дополнительных header controls

**Структура панелей:**
- **Левая панель**: чат ИЛИ свойства (взаимоисключающие)
- **Центральная панель**: 3D сцена (всегда видна)
- **Правая панель**: менеджер (независимая)

### ✅ 2.2 Рефакторинг ObjectEditorR3F
**Изменения в** `src/features/object-editor/ui/ObjectEditorR3F.tsx`:
- Полный переход на использование ObjectEditorLayout
- Вынос 3D контролов (сетка, трансформации, режим рендера) в headerControls
- Упрощение структуры компонента
- Сохранение всей существующей функциональности

### ✅ 2.3 Интеграция toggle buttons
**Автоматическая интеграция в:**
- Страница редактирования объекта (`ObjectEditorPage.tsx`)
- Модальное окно редактирования в SceneEditor

**Размещение кнопок:**
- Справа в header рядом с существующими контролами
- Визуальная индикация активного состояния
- Tooltips с описанием функциональности

### ✅ 2.4 Логика взаимоисключающих панелей
**Реализованные правила:**
- Чат и свойства не могут быть открыты одновременно
- Переключение с чата на свойства автоматически скрывает чат
- Менеджер работает независимо от левых панелей
- Состояние панелей сохраняется в localStorage

### ✅ 2.5 Автоматическое управление панелями
**Автоматические действия:**
- При выборе примитива/материала → скрыть чат, показать свойства
- Сохранение предпочтений пользователя
- Плавные переходы между панелями

## Технические детали

### Новая архитектура компонентов
```
ObjectEditorR3F (обновлен)
└── ObjectEditorLayout (новый)
    ├── PanelToggleButtons (интегрирован в header)
    ├── Left Panel (chat | properties)
    ├── Center Panel (3D scene)
    └── Right Panel (manager)
```

### Интерфейсы и типы
Используются существующие типы из phase 1:
- `PanelState` - состояние панелей
- `PanelType` - типы панелей  
- `PanelToggleProps` - свойства кнопок переключения

### Обратная совместимость
- Все существующие импорты `ObjectEditorR3F` продолжают работать
- Функциональность объект-редактора сохранена полностью
- Горячие клавиши и инструменты работают как прежде

## Критерии готовности

### ✅ Функциональные критерии
- [x] ObjectEditorLayout компонент создан с поддержкой переключаемых панелей
- [x] Toggle buttons интегрированы в header страницы редактирования объекта
- [x] Toggle buttons интегрированы в header модального окна редактирования
- [x] Реализована логика: чат и свойства взаимоисключающие (левая панель), менеджер независимый (правая панель)
- [x] Автоматическое скрытие чата при выборе примитива/материала работает корректно

### ✅ Технические критерии
- [x] TypeScript компилируется без ошибок
- [x] Сборка проекта проходит успешно
- [x] Все экспорты настроены корректно
- [x] Обратная совместимость сохранена

### ✅ Качественные критерии
- [x] Архитектура соответствует принципам FSD
- [x] Компоненты переиспользуемы и расширяемы
- [x] UI/UX не изменился для пользователя
- [x] Код хорошо структурирован

## Подготовка к следующей фазе

### Созданная инфраструктура
**ObjectEditorLayout** готов к приему компонента чата через props `chatComponent`

**Архитектурная схема (готово к интеграции чата):**
```
src/features/object-editor/ui/ObjectEditorLayout/
├── ObjectEditorLayout.tsx    ✅ Поддержка chatComponent prop
└── index.ts                  ✅ Экспорты настроены
```

### Интеграционные точки
- **Prop `chatComponent`** - для передачи чат-компонента в левую панель
- **Автоматическое переключение** - при выборе примитива чат скрывается
- **Состояние панелей** - управляется через `usePanelState` hook

### Готовность к фазе 3
Все необходимые компоненты для интеграции ChatInterface в object-editor созданы:
- Layout с поддержкой панелей ✅
- Система переключения ✅  
- Автоматическое управление ✅
- Обратная совместимость ✅

## Измененные файлы

**Созданные файлы:**
- `src/features/object-editor/ui/ObjectEditorLayout/ObjectEditorLayout.tsx`
- `src/features/object-editor/ui/ObjectEditorLayout/index.ts`

**Измененные файлы:**
- `src/features/object-editor/ui/ObjectEditorR3F.tsx` - переход на новый layout
- `src/features/object-editor/ui/index.ts` - добавлен экспорт ObjectEditorLayout

**Затронутые страницы:**
- `ObjectEditorPage.tsx` - автоматически получил toggle buttons
- Модальное окно в `SceneEditorR3F.tsx` - автоматически получило toggle buttons

## Следующая фаза

Переходим к **Фазе 3: Миграция SceneEditor ChatInterface**, где будет:
1. Перенесена специфичная логика из `widgets/ChatInterface.tsx` в `features/scene`
2. Выполнен переход на новый тип ChatMessage 
3. Обновлены все импорты в sceneEditor
4. Сохранена вся функциональность включая debug-панель