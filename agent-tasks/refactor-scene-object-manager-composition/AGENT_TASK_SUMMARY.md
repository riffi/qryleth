# Агентская задача: Рефакторинг SceneObjectManager с использованием композиции

## Ссылка на правила
Обязательно сверяйтесь с требованиями при выполнении каждой из фаз: [agent-tasks.md](../../docs/development/workflows/agent-tasks.md)

## Контекст задачи

### Проблема
Компонент `SceneObjectManager.tsx` передает множество свойств своим вложенным компонентам (`SceneLayerItem`, `SceneObjectItem`, `SceneLayerModals`), создавая проблему "prop drilling". Это приводит к:
- Сложности в поддержке кода
- Тесной связанности компонентов
- Затруднениям при добавлении новой функциональности
- Нарушению принципов композиции

### Текущая архитектура
```
SceneObjectManager (688 строк)
├── SceneLayerItem (48 пропов)
│   └── SceneObjectItem (22 пропа)
│       └── SceneObjectInstanceItem (11 пропов)
├── SceneLayerModals (52 пропа)
├── SceneHeader (2 пропа)
├── LightingControls (2 пропа)
└── AddObjectFromLibraryModal (5 пропов)
```

### Целевая архитектура (согласно design-principles.md)
- Использование compound-components вместо "prop-матрёшки"
- Применение контекста для передачи общих данных
- Разделение ответственности между компонентами
- Следование принципам FSD (feature-sliced design)

## План выполнения задачи

### Фаза 1: Создание контекста для SceneObjectManager 
- Создать `SceneObjectManagerContext` для общих данных и действий
- Выделить типы интерфейсов в отдельный файл
- Создать провайдер контекста

### Фаза 2: Рефакторинг SceneLayerModals 
- Переделать SceneLayerModals на использование контекста
- Убрать передачу множественных пропов
- Протестировать функциональность модальных окон

### Фаза 3: Рефакторинг SceneLayerItem 
- Переделать SceneLayerItem на использование контекста
- Убрать передачу пропов для действий с объектами
- Сохранить функциональность drag&drop и контекстного меню

### Фаза 4: Рефакторинг SceneObjectItem 
- Переделать SceneObjectItem на использование контекста
- Убрать лишние пропы для действий
- Сохранить все действия с объектами (edit, save, export, etc.)

### Фаза 5: Обновление SceneObjectManager 
- Обернуть основной компонент в провайдер контекста
- Убрать передачу пропов в дочерние компоненты
- Упростить основной компонент
- Протестировать всю функциональность

### Фаза 6: Документирование
- Отразить новую структуру SceneObjectManager в документации

## Архитектурные требования
- Следовать принципам FSD
- Не нарушать правила доступа слоёв
- Использовать compound-components
- Минимизировать prop drilling
- Сохранить существующую функциональность
- Обеспечить типобезопасность

## Результат
После выполнения всех фаз SceneObjectManager станет более модульным, легким в поддержке и расширении, с четким разделением ответственности между компонентами.
### Выполненные фазы
- [x] Фаза 1 - Создание контекста ([phases/phase_1_summary.md](phases/phase_1_summary.md))
- [x] Фаза 2 - Рефакторинг SceneLayerModals ([phases/phase_2_summary.md](phases/phase_2_summary.md))
- [ ] Фаза 3
- [ ] Фаза 4
- [ ] Фаза 5
- [ ] Фаза 6
